apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: longhorn-system
resources:
  - resources/servicemonitor.yaml
  - resources/storageclass.yaml
  # - resources/volume-snapshotclass.yaml
  # - patches/default-settings.yaml
generators:
  - ksops-generator.yaml
patches:
  - path: patches/remove-instance-patch.yaml
    target:
      kind: CustomResourceDefinition
      labelSelector: app.kubernetes.io/instance=longhorn
  - path: patches/frontend-service.yaml
    target:
      kind: Service
      name: longhorn-frontend-traefik
  - path: patches/hook.yaml
    target:
      name: pre-hook
      kind: Job
  - path: patches/default-settings-cm.yaml
    target:
      kind: ConfigMap
      name: longhorn-default-setting
# - path: patches/default-disks-config.yaml
#   target:
#     kind: CustomResourceDefinition
#     labelSelector: app.kubernetes.io/instance=longhorn

# - path: patches/storageclass-ssd-0.yaml
#   target:
#     kind: ConfigMap
#     name: longhorn-ssd-0

# - path: patches/storageclass-nvme-0.yaml
#   target:
#     kind: ConfigMap
#     name: longhorn-nvme-0
metadata:
  annotations:
    argocd.argoproj.io/compare-options: IgnoreExtraneous
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
    argocd.argoproj.io/sync-wave: "0"
  labels:
    app.kubernetes.io/name: longhorn
  name: longhorn
helmCharts:
  - name: longhorn
    version: 1.6.2
    repo: https://charts.longhorn.io
    includeCRDs: true
    namespace: longhorn-system
    releaseName: longhorn
    valuesFile: values.yaml
